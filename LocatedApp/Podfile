# platform :ios, '15.0'
platform :ios, '15.0'

target 'LocatedApp' do
  # Use static frameworks
  use_frameworks! :linkage => :static

  # Firebase Pods
  pod 'Firebase/Auth'
  pod 'Firebase/Core' # Core is often a dependency, good to have it explicit
  pod 'Firebase/Firestore'
  pod 'Firebase/Functions'
  pod 'Firebase/Messaging' # The new pod for notifications
  
  # Google Sign-In - use version compatible with current Firebase
  pod 'GoogleSignIn', '~> 6.2'

  target 'LocatedAppTests' do
    inherit! :search_paths
    # Pods for testing
  end

  target 'LocatedAppUITests' do
    # Pods for testing
  end

end

# Post-install script to fix build issues
post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      # Fix deployment target warnings by setting minimum to 15.0
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      
      # Fix BoringSSL-GRPC compilation issues
      if target.name.start_with?('BoringSSL-GRPC')
        # Remove all problematic compiler flags
        config.build_settings['OTHER_CFLAGS'] = ['$(inherited)', '-DBORINGSSL_PREFIX=GRPC']
        config.build_settings['OTHER_CPLUSPLUSFLAGS'] = ['$(inherited)', '-DBORINGSSL_PREFIX=GRPC']
        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] = ['$(inherited)', 'BORINGSSL_PREFIX=GRPC']
        
        # Ensure no -G flags are passed
        if config.build_settings['OTHER_CFLAGS']
          config.build_settings['OTHER_CFLAGS'] = config.build_settings['OTHER_CFLAGS'].reject { |flag| flag.include?('-G') }
        end
        if config.build_settings['OTHER_CPLUSPLUSFLAGS'] 
          config.build_settings['OTHER_CPLUSPLUSFLAGS'] = config.build_settings['OTHER_CPLUSPLUSFLAGS'].reject { |flag| flag.include?('-G') }
        end
      end
      
      # Fix gRPC issues
      if target.name == 'gRPC-Core'
        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']
        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'GRPC_CFSTREAM=0'
      end
    end
  end
end

